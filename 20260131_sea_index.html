<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Big Catch - ë””ì§€í„¸ ë‚šì‹œ ë³µê¶Œ</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° í°íŠ¸ ì„¤ì • */
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+KR:wght@400;700&display=swap');

        body {
            margin: 0;
            padding: 0;
            background-color: #0d1b2a; /* ê¹Šì€ ë°”ë‹¤ìƒ‰ */
            color: white;
            font-family: 'Noto Sans KR', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            cursor: none; /* ê¸°ë³¸ ì»¤ì„œ ìˆ¨ê¹€ (ì½”ì¸ ì»¤ì„œ ì‚¬ìš©) */
            touch-action: none; /* ëª¨ë°”ì¼ ì „ì²´ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        /* íƒ€ì´í‹€ ìŠ¤íƒ€ì¼ */
        header {
            text-align: center;
            margin-bottom: 15px;
            z-index: 10;
            padding: 0 10px;
            flex-shrink: 0;
        }

        h1 {
            font-family: 'Bebas Neue', cursive;
            font-size: 3.5rem; /* ëª¨ë°”ì¼ ê³ ë ¤ ì‚¬ì´ì¦ˆ ì¡°ì • */
            color: #808080; /* íšŒìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            margin: 0;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            line-height: 1;
        }

        /* ë³µê¶Œ ì»¨í…Œì´ë„ˆ - ì •ì‚¬ê°í˜• & ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        .scratch-card-container {
            position: relative;
            width: 85vw; /* ëª¨ë°”ì¼ í™”ë©´ ë„ˆë¹„ì˜ 85% */
            max-width: 450px; /* PCì—ì„œëŠ” ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šê²Œ ì œí•œ */
            aspect-ratio: 1 / 1; /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ ê°•ì œ ê³ ì • */
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 4px solid #808080; /* íšŒìƒ‰ í…Œë‘ë¦¬ë¡œ ë³€ê²½ */
            user-select: none;
            touch-action: none;
            flex-shrink: 0; /* ë ˆì´ì•„ì›ƒ ì°Œê·¸ëŸ¬ì§ ë°©ì§€ */
        }

        /* ê²°ê³¼ ì´ë¯¸ì§€ (ë°‘ë°”íƒ•) */
        .result-image {
            width: 100%;
            height: 100%;
            object-fit: cover; /* ì •ì‚¬ê°í˜• ì˜ì—­ì— ê½‰ ì°¨ê²Œ (ë¹„ìœ¨ ìœ ì§€í•˜ë©° ìë¦„) */
            /* object-fit: fill; /* ì´ë¯¸ì§€ë¥¼ ì°Œê·¸ëŸ¬ëœ¨ë ¤ì„œë¼ë„ ë‹¤ ë³´ì—¬ì£¼ë ¤ë©´ ì´ ì£¼ì„ì„ í•´ì œí•˜ê³  ìœ„ ì¤„ì„ ì£¼ì„ ì²˜ë¦¬í•˜ì„¸ìš” */
            display: block;
            z-index: 1;
        }

        /* ìŠ¤í¬ë˜ì¹˜ ìº”ë²„ìŠ¤ (ë®ê°œ) */
        #scratchCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            cursor: none;
            width: 100%;
            height: 100%;
        }

        /* í”¼ì‹± ì½”ì¸ ì»¤ì„œ ìŠ¤íƒ€ì¼ ìˆ˜ì •ë¨ */
        #fishingCoin {
            position: fixed;
            width: 60px; 
            height: 60px;
            /* ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • (symbol.webp) */
            background: #ffd700 url('https://jaegyunkim.github.io/todaysfishing/symbol.webp') no-repeat center center;
            background-size: cover; /* ì´ë¯¸ì§€ê°€ ì½”ì¸ ì•ˆì— ê½‰ ì°¨ë„ë¡ */
            border-radius: 50%;
            box-shadow: 4px 4px 10px rgba(0,0,0,0.5), inset -2px -2px 5px rgba(0,0,0,0.2);
            border: 2px solid #808080; /* íšŒìƒ‰ í…Œë‘ë¦¬ë¡œ ë³€ê²½ */
            pointer-events: none; /* í´ë¦­ í†µê³¼ */
            z-index: 9999;
            display: block; /* flex ì œê±° (í…ìŠ¤íŠ¸ ì—†ìœ¼ë¯€ë¡œ) */
            transform: translate(-50%, -50%); /* ì¤‘ì•™ ì •ë ¬ */
            transition: transform 0.1s ease;
        }

        /* í…ìŠ¤íŠ¸ ì œê±° */
        #fishingCoin::after {
            content: '';
        }

        /* ê¸ì„ ë•Œ ì½”ì¸ íš¨ê³¼ */
        body.is-scratching #fishingCoin {
            transform: translate(-50%, -50%) scale(0.9);
        }

        /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ */
        .controls {
            margin-top: 20px;
            z-index: 10;
            flex-shrink: 0;
        }

        button {
            background-color: #808080; /* íšŒìƒ‰ ë°°ê²½ìœ¼ë¡œ ë³€ê²½ */
            color: white; /* í…ìŠ¤íŠ¸ëŠ” í°ìƒ‰ ìœ ì§€ */
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px; /* ë‘¥ê·¼ ë²„íŠ¼ */
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.1s, background 0.2s;
        }

        button:hover {
            background-color: #a0a0a0; /* í˜¸ë²„ ì‹œ ì•½ê°„ ë°ì€ íšŒìƒ‰ */
        }

        button:active {
            transform: scale(0.95);
        }

        @media (max-width: 480px) {
            h1 { font-size: 3rem; }
            .scratch-card-container { width: 90vw; } /* ë” ì‘ì€ í™”ë©´ì—ì„  ë” ë„“ê²Œ */
            /* ëª¨ë°”ì¼ì—ì„œë„ ì½”ì¸ ì»¤ì„œë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ 'ë””ì§€í„¸ ë³µê¶Œ' ëŠë‚Œì„ ì‚´ë¦¼ */
        }
    </style>
</head>
<body>

    <header>
        <h1>THE BIG CATCH</h1>
    </header>

    <div class="scratch-card-container" id="cardContainer">
        
        <!-- ê²°ê³¼ ì´ë¯¸ì§€ (ìš”ì²­í•˜ì‹  URL) -->
        <!-- object-fit: coverë¡œ ì„¤ì •ë˜ì–´ ì •ì‚¬ê°í˜• ì˜ì—­ì„ ê½‰ ì±„ì›ë‹ˆë‹¤ -->
        <img src="https://jaegyunkim.github.io/todaysfishing/20260131_sea_index.png" 
             alt="Fishing Index Result" 
             class="result-image" 
             id="resultImage"
             crossorigin="anonymous"> 

        <!-- ë®ê°œ ìº”ë²„ìŠ¤ -->
        <canvas id="scratchCanvas"></canvas>
    </div>

    <div class="controls">
        <button onclick="resetScratchCard()">ë‹¤ì‹œ ê¸ê¸°</button>
    </div>

    <!-- ì»¤ìŠ¤í…€ ì½”ì¸ ì»¤ì„œ -->
    <div id="fishingCoin"></div>

    <script>
        // --- ì„¤ì • ë³€ìˆ˜ ---
        const container = document.getElementById('cardContainer');
        const canvas = document.getElementById('scratchCanvas');
        const ctx = canvas.getContext('2d');
        const coin = document.getElementById('fishingCoin');
        const resultImg = document.getElementById('resultImage');
        
        let isDrawing = false;
        let isRevealed = false; // ë‹¹ì²¨(ì™„ì „ ê³µê°œ) ì—¬ë¶€

        // --- ì´ˆê¸°í™” í•¨ìˆ˜ ---
        function initCard() {
            // CSSë¡œ ê°•ì œëœ ì»¨í…Œì´ë„ˆ í¬ê¸°(ì •ì‚¬ê°í˜•) ê°€ì ¸ì˜¤ê¸°
            const width = container.offsetWidth;
            const height = container.offsetHeight;

            // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶¤
            canvas.width = width;
            canvas.height = height;

            // íšŒìƒ‰ ë®ê°œ ê·¸ë¦¬ê¸°
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = '#C0C0C0'; // ì€ìƒ‰/íšŒìƒ‰
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // í…ìŠ¤íŠ¸ ì¶”ê°€ (ê¸ê¸° ìœ ë„)
            ctx.font = 'bold 20px "Noto Sans KR"';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ë‚šë§› ì½”ì¸ìœ¼ë¡œ ê¸ì–´ì£¼ì„¸ìš”!', canvas.width / 2, canvas.height / 2);
            
            // íŒ¨í„´ ì¶”ê°€ (ë¦¬ì–¼í•¨ ì¦ê°€)
            addNoise();

            isRevealed = false;
        }

        // --- ë…¸ì´ì¦ˆ íŒ¨í„´ ì¶”ê°€ (ë³µê¶Œ ì§ˆê°) ---
        function addNoise() {
            const w = canvas.width;
            const h = canvas.height;
            const idata = ctx.getImageData(0, 0, w, h);
            const buffer32 = new Uint32Array(idata.data.buffer);
            
            for (let i = 0; i < buffer32.length; i++) {
                if (Math.random() < 0.1) {
                    buffer32[i] = 0xffaaaaaa; 
                }
            }
            ctx.putImageData(idata, 0, 0);
        }

        // --- ìŠ¤í¬ë˜ì¹˜ ë¡œì§ ---
        function scratch(x, y) {
            if (isRevealed) return;

            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            // í™”ë©´ í¬ê¸°ì— ë”°ë¼ ë¸ŒëŸ¬ì‰¬ í¬ê¸° ì¡°ì • (ë„ˆë¬´ ì‘ìœ¼ë©´ ë‹µë‹µí•¨)
            const brushSize = canvas.width / 10; 
            ctx.arc(x, y, brushSize, 0, Math.PI * 2);
            ctx.fill();

            // ì§„í–‰ë¥  ì²´í¬
            checkScratchPercent();
        }

        // --- ì§„í–‰ë¥  í™•ì¸ ë° ìë™ ê³µê°œ ---
        function checkScratchPercent() {
            if (Math.random() > 0.15) return; // ì„±ëŠ¥ ìµœì í™”

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let transparentPixels = 0;
            const totalPixels = pixels.length / 4;

            for (let i = 0; i < pixels.length; i += 4 * 10) {
                if (pixels[i + 3] === 0) {
                    transparentPixels++;
                }
            }

            const percent = (transparentPixels * 10) / totalPixels * 100;

            if (percent > 45) { // 45% ì´ìƒ ê¸ìœ¼ë©´
                revealAll();
            }
        }

        function revealAll() {
            if(isRevealed) return;
            isRevealed = true;
            
            canvas.style.transition = 'opacity 0.8s';
            canvas.style.opacity = '0';
            
            setTimeout(() => {
                // ì•Œë¦¼ì°½ ëŒ€ì‹  ì„¸ë ¨ëœ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë‚˜ ê·¸ëƒ¥ ì´ë¯¸ì§€ ë³´ì—¬ì£¼ê¸°
                // alert("ğŸ£ ëŒ€ì–´(The Big Catch) ë‚šì‹œ ì„±ê³µ!"); 
                canvas.style.visibility = 'hidden';
            }, 500);
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            // ìº”ë²„ìŠ¤ í¬ê¸°ì™€ í‘œì‹œ í¬ê¸°ê°€ ê°™ìœ¼ë¯€ë¡œ 1:1 ë§¤í•‘ì´ì§€ë§Œ ì•ˆì „í•˜ê²Œ ê³„ì‚°
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            let clientX, clientY;
            if (e.touches) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        // ë§ˆìš°ìŠ¤
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            document.body.classList.add('is-scratching');
            const pos = getPos(e);
            scratch(pos.x, pos.y);
        });

        window.addEventListener('mousemove', (e) => {
            coin.style.left = e.clientX + 'px';
            coin.style.top = e.clientY + 'px';

            if (isDrawing) {
                const pos = getPos(e);
                scratch(pos.x, pos.y);
            }
        });

        window.addEventListener('mouseup', () => {
            isDrawing = false;
            document.body.classList.remove('is-scratching');
        });

        // í„°ì¹˜ (ëª¨ë°”ì¼)
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isDrawing = true;
            
            // í„°ì¹˜ ì‹œì‘ ìœ„ì¹˜ë¡œ ì½”ì¸ ì´ë™
            if(e.touches[0]) {
                coin.style.left = e.touches[0].clientX + 'px';
                coin.style.top = e.touches[0].clientY + 'px';
            }

            const pos = getPos(e);
            scratch(pos.x, pos.y);
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            
            // í„°ì¹˜ ì´ë™ ìœ„ì¹˜ë¡œ ì½”ì¸ ì´ë™
            if(e.touches[0]) {
                coin.style.left = e.touches[0].clientX + 'px';
                coin.style.top = e.touches[0].clientY + 'px';
            }

            if (isDrawing) {
                const pos = getPos(e);
                scratch(pos.x, pos.y);
            }
        }, { passive: false });

        canvas.addEventListener('touchend', () => {
            isDrawing = false;
        });

        // ì´ˆê¸°í™”
        resultImg.onload = function() {
            initCard();
        };

        if (resultImg.complete) {
            initCard();
        } else {
             setTimeout(() => {
                 initCard();
             }, 300);
        }

        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì´ˆê¸°í™” (ë°˜ì‘í˜• ëŒ€ì‘)
                if (!isRevealed) {
                    initCard(); 
                }
            }, 200);
        });

        window.resetScratchCard = function() {
            canvas.style.opacity = '1';
            canvas.style.visibility = 'visible';
            canvas.style.transition = 'none';
            initCard();
        };

    </script>
</body>
</html>